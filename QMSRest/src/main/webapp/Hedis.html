
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

	<!--
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">	
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	-->
	
    <link rel="stylesheet" href="index_js_css/bootstrap.min.css">
	<script src="index_js_css/jquery.min.js"></script>
	<script src="index_js_css/maxcdn_bootstrap.min.js"></script>
    <!--<link rel="stylesheet" href="index_js_css/font-awesome.min.css">-->
	<link rel="stylesheet" href="index_js_css/font-awesome.min.css">
    <!-- <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css"> -->
	<link href="index_js_css/Material_Icons.css" rel="stylesheet">	
	
	
	
	
    <script src="annyang.min.js"></script> <!-- Voice Recognition -->
    <script src="responsivevoice.js"></script> <!-- Voice Response -->
	
    <script src="download/angular.min.js"></script>
	<script src="download/angular.js"></script>
	<script src="download/angular-route.js"></script>	
	
	<script src="qms_home.js"></script>	
    <script src="qms_common.js"></script>
	
    <!--<script src="http://public.tableausoftware.com/javascripts/api/tableau_v8.js" type="text/javascript"></script>  -->
	<script src="download/tableau_v8.js" type="text/javascript"></script>  
     <link rel="stylesheet" href="styles/qms_styles.css">
     <style type="text/css">
     	#tableauViz{
     		height: 90vh;
     	}
     </style>
</head>	

<body onload="initializeViz()" ng-app="QMSHomeManagement" ng-controller="IndexDotHTMLController">
	  <header class="header col-md-12" style="width: 100%;">
        <a href="index.html">
        <img class="logo" src="images/LOGOitcinfotech.jpg"/>
    </a>

        <!-- <div class="reflink">
            <a href="#">Contact Us</a>&nbsp; &nbsp; &nbsp;
            <a href="#">About</a>&nbsp; &nbsp; &nbsp;
            <a href="#">Logout</a>&nbsp; &nbsp; &nbsp;
         <a href="patient_profile.html" id="pp">Patient_Profile</a>
        </div> -->
        <ul class="nav navbar-nav navbar-right" style="padding-right: 14px;display: -webkit-box;
    float: right;">
  <li> <img src="images/speech.png" style="width: auto; height: 6vh;cursor: pointer;margin-top: 10px;float: left;margin-right: 15px;" class=" SpeechIcon"></li>
                <!-- <li><a href="patient_profile.html" id="pp">Patient Profile</a></li> -->
               <li style="margin-right: 20px; margin-top: 5px;"><b>
			   <!--<span ng-bind="userName"></span>-->
			   <span id="userName" name="userName"></span>
			   <br></b></li>               
                <li style="margin-right: 25px;margin-top: 5px;">
                    <div>
                        <img src="images/doc.png" width="40px" height="40px" class="dropdown-toggle" data-toggle="dropdown">
                        <ul class="dropdown-menu" role="menu">
                            <li><a href="#" style="color: black;
    background-color: #FFFFFF;
    border-radius: 5px;
    width: 100px;" onclick="logOut()">Logout</a>
                            </li>

                        </ul>
                    </div>
                </li>

                <!--<li><i class="material-icons" style="font-size:25px; font-weight: 600;margin-top: 3px;">info_outline</i></li>-->
            </ul>

    </header>
<div id='tableauViz'></div>

<script>
if (annyang) {
  // These are the voice commands in quotes followed by the function
  var commands = {
  	//commands for Facility_Name
  	'Select Lakeside': function() { selectLakeside(); responsiveVoice.speak('selecting Lakeside', "UK English Female"); },
  	'Select Carehoods': function() { selectCarehoods(); responsiveVoice.speak('selecting Carehoods', "UK English Female"); },
  	'Select Sisters Medical': function() { selectSM(); responsiveVoice.speak('selecting Sisters Medical', "UK English Female"); },
	'Select Solano': function() { selectSolano(); responsiveVoice.speak('selecting Solano', "UK English Female"); },
     'Select Navato': function() { selectNavato(); responsiveVoice.speak('selecting Navato', "UK English Female"); },
	 'Select Memorial Hospital': function() { selectMH(); responsiveVoice.speak('selecting Memorial Hospital', "UK English Female"); },
     //commands for Operating Unit
     'Select North': function() { selectNorth(); responsiveVoice.speak('selecting North', "UK English Female"); },
     'Select South': function() { selectSouth(); responsiveVoice.speak('selecting South', "UK English Female"); },
     //commands for Loc_Name
     'Select Northridge': function() { selectNorthridge(); responsiveVoice.speak('selecting Northridge', "UK English Female"); },
     'Select Oakland': function() { selectOakland(); responsiveVoice.speak('selecting Oakland', "UK English Female"); },
     'Select Orange': function() { selectOrange(); responsiveVoice.speak('selecting Orange', "UK English Female"); },
	'Open Quality Center': function() { selectQC(); responsiveVoice.speak('Showing Quality Center Dashboard', "UK English Female"); },
	'Open Measure Prioritizer': function() { selectMP(); responsiveVoice.speak('Showing Measure Prioritizer Dashboard', "UK English Female"); },
	'Open Diabetes Eye Exam': function() { selectDEE(); responsiveVoice.speak('Showing Diabetes Eye Exam Dashboard', "UK English Female"); },
	'Drill Down to Compliance': function() { selectDEEC(); responsiveVoice.speak('Showing Compliance Dashboard', "UK English Female"); },
	'Drill Down to Patient Details': function() { selectDEEPD(); responsiveVoice.speak('Showing Patient Details Dashboard', "UK English Female"); },
	'Drill Up to Diabetes Eye Exam': function() { selectDEE(); responsiveVoice.speak('Showing Diabetes Eye Exam Dashboard', "UK English Female"); },
	'Drill Up to Compliance': function() { selectDEEC(); responsiveVoice.speak('Showing Compliance Dashboard', "UK English Female"); },
	'Open Control Tower': function() { selectMCT(); responsiveVoice.speak('Showing MIPS Control Tower Dashboard', "UK English Female"); },
	'Open Patient Profile for 3124': function() {  responsiveVoice.speak('Showing Patient Profile', "UK English Female"); selectPP();},
	'Open Health Insights HomePage': function() {  responsiveVoice.speak('Showing Health Insights HomePage', "UK English Female"); selectCurisHome();},
  'Open QMS HomePage': function() {  responsiveVoice.speak('Showing QMS HomePage', "UK English Female"); selectQmsHome();},
     //Command To reset all the filters
	'start over': function() { startover(); responsiveVoice.speak('starting over'); }

 };
  
  // Add commands to annyang
  annyang.addCommands(commands);
  
  // Start listening.
  annyang.start({continuous:false});
  annyang.debug();
//	annyang.start({ autoRestart: true });
}
</script>
 
<script>
var viz, workbook, activeSheet, Worksheet, worksheet;

var worksheets_to_listen_on = {'Patient Details' : true};

var tokenResponse = "";
function getTableauToken() {
	var xhttp = new XMLHttpRequest();	
	xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			tokenResponse = xhttp.responseText;
			initializeViz();
		}
	};
	xhttp.open("POST", "http://192.168.184.70/trusted",true);	
	xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	xhttp.setRequestHeader("Accept", "application/json");
	xhttp.send("username=raghukonda");
}

function initializeViz(){
var placeholderDiv = document.getElementById("tableauViz");


//var url = "https://public.tableau.com/views/CurisDashboard_HEDIS_Measure_160518/HEDIS_Plan"
var url = "http://192.168.184.70/views/CurisDashboard_HEDIS/HEDIS_Plan?:embed=y&:display_count=no&:showAppBanner=false&:showShareOptions=true&:showVizHome=no"

	var options = {
	width: "100%",   
	height: "100%",
	hideTabs: true,
	hideToolbar: true,
	onFirstInteractive: function () {
			workbook = viz.getWorkbook();
			activeSheet = workbook.getActiveSheet().getWorksheets().get("Filter Sheet");			
			//listenToMarksSelection();
			
		//added1505
		viz.addEventListener(tableau.TableauEventName.MARKS_SELECTION, onMarksSelection);
		}
	};
	viz = new tableauSoftware.Viz(placeholderDiv, url, options);
}


		//added1505
        function onMarksSelection(marksEvent) {
				//return marksEvent.getMarksAsync().then(reportSelectedMarks); 
				return marksEvent.getMarksAsync().then(getMRNValue); 
        }		
		function getMRNValue(marks) {
			var mrnValue;
			for (var markIndex = 0; markIndex < marks.length; markIndex++) {
                var pairs = marks[markIndex].getPairs();

                for (var pairIndex = 0; pairIndex < pairs.length; pairIndex++) {
                    var pair = pairs[pairIndex];
					if(pair.fieldName == "MRN"){
						mrnValue = pair.formattedValue;
						break;
					}
                }
            }
			//var scope = angular.element(document.getElementById("tableauViz")).scope();
			//alert("scope --> " + scope);
			//scope.$apply(function () {
			//	scope.viewPatientProfile(mrnValue);
			//});
						
			var xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					var response = xhttp.responseText;
					console.log("ok"+response);
					window.sessionStorage.setItem("patientProfileData",response);
					window.location.href="QMS_Patient_Profile.jsp";
				}
			};
			xhttp.open("GET", "http://localhost:8082/curis/qms/spv/hedis/"+mrnValue, true);
			//xhttp.open("GET", "http://localhost:8082/curis/qms/spv/hedis/2016062", true);
			xhttp.send(); 
		}



		/** to get the MRN value for begin 
        function listenToMarksSelection() {
            viz.addEventListener(tableau.TableauEventName.MARKS_SELECTION, onMarksSelection);
        }

        function onMarksSelection(marksEvent) {
				var ws = marksEvent.getWorksheet();
                var ws_name = ws.getName();
                alert("ws_name --> " + ws_name);
                if ( worksheets_to_listen_on[ws_name]) {
                    alert(" added async lsitener ");				
					return marksEvent.getMarksAsync().then(getMRNValue); 
				}
        }
		
		function getMRNValue(marks) {
			var mrnValue;
			for (var markIndex = 0; markIndex < marks.length; markIndex++) {
                var pairs = marks[markIndex].getPairs();

                for (var pairIndex = 0; pairIndex < pairs.length; pairIndex++) {
                    var pair = pairs[pairIndex];
					if(pair.fieldName == "MRN")
					{
						mrnValue = pair.formattedValue;
						break;
					}
                }
            }
			alert("mrnValue --> " + mrnValue);
		}
		/** to get the MRN value for end **/

//Tabitha says hello
//responsiveVoice.speak('Hi. My name is Ask Curis. How may I help you?');

//Make Faacility Name selection

function selectSolano()
	{
activeSheet = workbook.getActiveSheet().getWorksheets().get("Filter Sheet");

	activeSheet.applyFilterAsync("Facility Name","SOLANO",tableau.FilterUpdateType.REPLACE);
}
function selectNavato()
	{
activeSheet = workbook.getActiveSheet().getWorksheets().get("Filter Sheet");

	activeSheet.applyFilterAsync("Facility Name","NAVATO",tableau.FilterUpdateType.REPLACE);
}

function selectLakeside()
	{
activeSheet = workbook.getActiveSheet().getWorksheets().get("Filter Sheet");

	activeSheet.applyFilterAsync("Facility Name","LAKESIDE",tableau.FilterUpdateType.REPLACE);
}
function selectCarehoods()
	{
activeSheet = workbook.getActiveSheet().getWorksheets().get("Filter Sheet");

	activeSheet.applyFilterAsync("Facility Name","CAREHOODS",tableau.FilterUpdateType.REPLACE);
}
function selectSM()
	{
activeSheet = workbook.getActiveSheet().getWorksheets().get("Filter Sheet");

	activeSheet.applyFilterAsync("Facility Name","SISTERS MEDICAL",tableau.FilterUpdateType.REPLACE);
}
function selectMH()
	{
activeSheet = workbook.getActiveSheet().getWorksheets().get("Filter Sheet");

	activeSheet.applyFilterAsync("Facility Name","MEMORIAL HOSPITAL",tableau.FilterUpdateType.REPLACE);
}
//Make Operating Unit Selection
function selectNorth()
	{
activeSheet = workbook.getActiveSheet().getWorksheets().get("Filter Sheet");

	activeSheet.applyFilterAsync("OU_New","NORTH",tableau.FilterUpdateType.REPLACE);
}
function selectSouth()
	{
activeSheet = workbook.getActiveSheet().getWorksheets().get("Filter Sheet");

	activeSheet.applyFilterAsync("OU_New","SOUTH",tableau.FilterUpdateType.REPLACE);
}
function selectQC()
	{
		viz.getWorkbook().activateSheetAsync("Quality_Center_WF");
}
function selectMP()
	{
		viz.getWorkbook().activateSheetAsync("Measure Prioritizer");
}
function selectDEE()
	{
		viz.getWorkbook().activateSheetAsync("Measure Details_Diabetes Eye Exam");
}
function selectDEEC()
	{
		viz.getWorkbook().activateSheetAsync("Compliance_Diabetes Eye Exam");
}
function selectDEEPD()
	{
		viz.getWorkbook().activateSheetAsync("Patient Details_Diabetes Eye Exam");
}
function selectMCT()
	{
		viz.getWorkbook().activateSheetAsync("MIPS_Control_Tower");
}
function selectPP()
	{
		window.location.href="Patient_Profile.html";
}

function selectCurisHome()
  {
    window.location.href="index.html";
}
function selectQmsHome()
  {
    window.location.href="qms_landing.jsp";
}
/*function selectNext()
	{
	activeSheet2.getWorksheets()[2].selectMarksAsync('Next', 'Next', 'REPLACE'); 
	}	

*/
	
//Start Viz Over
function startover()
	{
       
	viz.revertAllAsync();
	}

</script>

</body>
</html>		
		<script type="text/javascript">
    if (annyang) {
      $('.SpeechIcon').click(function() {
      var clicks = $(this).data('clicks');
       if (clicks) {
            annyang.start();
            $(this).attr('src',"speech.png");
            console.log("started");
            } 
            else {
               
            annyang.abort();
             $(this).attr('src',"speech_mute.png");
            console.log("stopped");

            }
            $(this).data("clicks", !clicks);
           });
    }
</script>