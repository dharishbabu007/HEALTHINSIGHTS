CREATE OR REPLACE FORCE VIEW "ADMIN"."MIPS_PATIENT_VIEW" ("PATIENT_SK", "PAT_ID", "NAME", "GENDER", "PAT_CITY", "PAT_MRN", "PCP", "DOB", "YEAR", "AGE", "AGE_GROUP", "QUALITY_MEASURE_SK", "COMPLIANT") AS 
(SELECT DISTINCT ENC.PATIENT_SK, ENC.PAT_ID, (ENC.PAT_FIRST_NAME||' '||ENC.PAT_MIDDLE_NAME||' '||ENC.PAT_LAST_NAME) AS NAME, ENC.GENDER, ENC.PAT_CITY, ENC.PAT_MRN, (DP.FIRST_NAME|| ' ' || DP.LAST_NAME) AS PCP, TO_CHAR(TO_DATE(SUBSTR(ENC.DATE_OF_BIRTH_SK, 1, 4) || '-' || SUBSTR(ENC.DATE_OF_BIRTH_SK, 5,2) || '-' || SUBSTR(ENC.DATE_OF_BIRTH_SK, 7,2),'YYYY-MM-DD'),'YYYY-MM-DD') AS DOB, TO_CHAR(TO_DATE(SUBSTR(ENC.DATE_OF_BIRTH_SK, 1, 4) || '-' || SUBSTR(ENC.DATE_OF_BIRTH_SK, 5,2) || '-' || SUBSTR(ENC.DATE_OF_BIRTH_SK, 7,2),'YYYY-MM-DD'),'YYYY') AS YEAR, ((TO_DATE('2018-12-31','YYYY-MM-DD') - TO_DATE(SUBSTR(ENC.DATE_OF_BIRTH_SK, 1, 4) || '-' || SUBSTR(ENC.DATE_OF_BIRTH_SK, 5,2) || '-' || SUBSTR(ENC.DATE_OF_BIRTH_SK, 7,2),'YYYY-MM-DD')))/365.25 AS AGE, DA.AGE_GROUP, FH.QUALITY_MEASURE_SK, FH.IN_NUMERATOR AS COMPLIANT 
FROM DIM_PATIENT ENC
LEFT OUTER JOIN FACT_ENC FC ON FC.PATIENT_SK = ENC.PATIENT_SK
LEFT OUTER JOIN FACT_MIPS_GAPS_IN_CARE FH ON FH.PATIENT_SK = ENC.PATIENT_SK
LEFT OUTER JOIN DIM_MEASURE_AGE_GROUP DA ON DA.QUALITY_MEASURE_SK = FH.QUALITY_MEASURE_SK
LEFT OUTER JOIN DIM_PROVIDER DP ON DP.PROVIDER_SK = FC.PCP_PROV_SK
WHERE ((TO_DATE('2018-12-31','YYYY-MM-DD') - TO_DATE(SUBSTR(ENC.DATE_OF_BIRTH_SK, 1, 4) || '-' || SUBSTR(ENC.DATE_OF_BIRTH_SK, 5,2) || '-' || SUBSTR(ENC.DATE_OF_BIRTH_SK, 7,2),'YYYY-MM-DD')))/365.25 BETWEEN DA.START_AGE AND DA.END_AGE);